{"version":3,"file":"header.min.js","sources":["../../../../src/local/content/section/header.js"],"sourcesContent":["// This file is part of Moodle - http://moodle.org/\n//\n// Moodle is free software: you can redistribute it and/or modify\n// it under the terms of the GNU General Public License as published by\n// the Free Software Foundation, either version 3 of the License, or\n// (at your option) any later version.\n//\n// Moodle is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with Moodle.  If not, see <http://www.gnu.org/licenses/>.\n\n/**\n * Course section header component.\n *\n * This component is used to control specific course section interactions like drag and drop.\n *\n * @module     core_courseformat/local/content/section/header\n * @class      core_courseformat/local/content/section/header\n * @copyright  2021 Ferran Recio <ferran@moodle.com>\n * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later\n */\n\nimport DndSectionItem from 'core_courseformat/local/courseeditor/dndsectionitem';\n\nexport default class extends DndSectionItem {\n\n    /**\n     * Constructor hook.\n     *\n     * @param {Object} descriptor\n     */\n    create(descriptor) {\n        // Optional component name for debugging.\n        this.name = 'content_section_header';\n        // Default query selectors.\n        this.selectors = {\n            ACTIONSMENU: `.section_action_menu`,\n            BULKSELECT: `[data-for='sectionBulkSelect']`,\n            BULKCHECKBOX: `[data-bulkcheckbox]`,\n        };\n        this.classes = {\n            HIDE: 'd-none',\n            SELECTED: 'selected',\n        };\n        // Get main info from the descriptor.\n        this.id = descriptor.id;\n        this.section = descriptor.section;\n        this.course = descriptor.course;\n        this.fullregion = descriptor.fullregion;\n    }\n\n    /**\n     * Initial state ready method.\n     *\n     * @param {Object} state the initial state\n     */\n    stateReady(state) {\n        this.configDragDrop(this.id, state, this.fullregion);\n        this._refreshBulk({state});\n    }\n\n    /**\n     * Component watchers.\n     *\n     * @returns {Array} of watchers\n     */\n    getWatchers() {\n        return [\n            {watch: `bulk:updated`, handler: this._refreshBulk},\n        ];\n    }\n\n    /**\n     * Update a bulk options.\n     *\n     * @param {object} param\n     * @param {Object} param.state the state data\n     */\n    _refreshBulk({state}) {\n        const bulk = state.bulk;\n        if (!this._isSectionBulkEditable()) {\n            return;\n        }\n        // For now, dragging elements in bulk is not possible.\n        this.setDraggable(!bulk.enabled);\n        this.getElement(this.selectors.BULKSELECT)?.classList.toggle(this.classes.HIDE, !bulk.enabled);\n\n        const disabled = !this._isSectionBulkEnabled(bulk);\n        const selected = this._isSelected(bulk);\n        this.element.classList.toggle(this.classes.SELECTED, selected);\n        this._setCheckboxValue(selected, disabled);\n    }\n\n    /**\n     * Modify the checkbox element.\n     * @param {Boolean} checked the new checked value\n     * @param {Boolean} disabled the new disabled value\n     */\n    _setCheckboxValue(checked, disabled) {\n        const checkbox = this.getElement(this.selectors.BULKCHECKBOX);\n        if (!checkbox) {\n            return;\n        }\n        checkbox.checked = checked;\n        checkbox.disabled = disabled;\n        // Is selectable is used to easily scan the page for bulk checkboxes.\n        if (disabled) {\n            checkbox.removeAttribute('data-is-selectable');\n        } else {\n            checkbox.dataset.isSelectable = 1;\n        }\n    }\n\n    /**\n     * Check if cm bulk selection is available.\n     * @param {Object} bulk the current state bulk attribute\n     * @returns {Boolean}\n     */\n    _isSectionBulkEnabled(bulk) {\n        if (!bulk.enabled) {\n            return false;\n        }\n        return (bulk.selectedType === '' || bulk.selectedType === 'section');\n    }\n\n    /**\n     * Check if the section is bulk editable.\n     * @return {Boolean}\n     */\n    _isSectionBulkEditable() {\n        const section = this.reactive.get('section', this.id);\n        return section?.bulkeditable ?? false;\n    }\n\n    /**\n     * Check if the cm id is part of the current bulk selection.\n     * @param {Object} bulk the current state bulk attribute\n     * @returns {Boolean}\n     */\n    _isSelected(bulk) {\n        if (bulk.selectedType !== 'section') {\n            return false;\n        }\n        return bulk.selection.includes(this.id);\n    }\n}\n"],"names":["DndSectionItem","create","descriptor","name","selectors","ACTIONSMENU","BULKSELECT","BULKCHECKBOX","classes","HIDE","SELECTED","id","section","course","fullregion","stateReady","state","configDragDrop","this","_refreshBulk","getWatchers","watch","handler","bulk","_isSectionBulkEditable","setDraggable","enabled","getElement","classList","toggle","disabled","_isSectionBulkEnabled","selected","_isSelected","element","_setCheckboxValue","checked","checkbox","removeAttribute","dataset","isSelectable","selectedType","reactive","get","bulkeditable","selection","includes"],"mappings":";;;;;;;;;;oLA4B6BA,wBAOzBC,OAAOC,iBAEEC,KAAO,8BAEPC,UAAY,CACbC,mCACAC,4CACAC,yCAECC,QAAU,CACXC,KAAM,SACNC,SAAU,iBAGTC,GAAKT,WAAWS,QAChBC,QAAUV,WAAWU,aACrBC,OAASX,WAAWW,YACpBC,WAAaZ,WAAWY,WAQjCC,WAAWC,YACFC,eAAeC,KAAKP,GAAIK,MAAOE,KAAKJ,iBACpCK,aAAa,CAACH,MAAAA,QAQvBI,oBACW,CACH,CAACC,qBAAuBC,QAASJ,KAAKC,eAU9CA,4CAAaH,MAACA,kBACJO,KAAOP,MAAMO,SACdL,KAAKM,qCAILC,cAAcF,KAAKG,uCACnBC,WAAWT,KAAKd,UAAUE,0DAAasB,UAAUC,OAAOX,KAAKV,QAAQC,MAAOc,KAAKG,eAEhFI,UAAYZ,KAAKa,sBAAsBR,MACvCS,SAAWd,KAAKe,YAAYV,WAC7BW,QAAQN,UAAUC,OAAOX,KAAKV,QAAQE,SAAUsB,eAChDG,kBAAkBH,SAAUF,UAQrCK,kBAAkBC,QAASN,gBACjBO,SAAWnB,KAAKS,WAAWT,KAAKd,UAAUG,cAC3C8B,WAGLA,SAASD,QAAUA,QACnBC,SAASP,SAAWA,SAEhBA,SACAO,SAASC,gBAAgB,sBAEzBD,SAASE,QAAQC,aAAe,GASxCT,sBAAsBR,cACbA,KAAKG,UAGoB,KAAtBH,KAAKkB,cAA6C,YAAtBlB,KAAKkB,cAO7CjB,yDACUZ,QAAUM,KAAKwB,SAASC,IAAI,UAAWzB,KAAKP,yCAC3CC,MAAAA,eAAAA,QAASgC,qEAQpBX,YAAYV,YACkB,YAAtBA,KAAKkB,cAGFlB,KAAKsB,UAAUC,SAAS5B,KAAKP"}